<?xml version="1.0" encoding="utf-8"?>
<openerp>
    <data>
    
		<template id="directory_grid">						
			<!-- VISTA GRID -->
			<div class="modal fade" tabindex="-1" role="dialog" id="map-viewer">
				<div class="modal-dialog">
			    	<div class="modal-content">
			      		<div class="modal-header">
			        		<button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true"><i class="fa fa-close"></i></span></button>
			        		<h4 class="modal-title">Mapa</h4>
			      		</div>
			      		<div class="modal-body">
			        		<img id="map-img" />
			      		</div>
			      		<div class="modal-footer">
			        		<button type="button" class="btn btn-default" data-dismiss="modal">Cerrar</button>
			      		</div>
			    	</div><!-- /.modal-content -->
			  	</div><!-- /.modal-dialog -->
			</div><!-- /.modal -->
			<t t-foreach="bins" t-as="tr_product">
				<t t-foreach="tr_product" t-as="td_product">
					<t t-if="td_product">
						<t t-set="establecimiento" t-value="td_product['establecimiento']"/>
                      	<t t-set="producto_contratado" t-value="td_product['producto_contratado']"/>
                      	<t t-set="evento" t-value="td_product['events'] if 'events' in td_product and len(td_product['events'])==1 else False"/>
						
						<!-- GRID -->
						<t t-if="request.session['directory_view'] == 'grid'">
							<div class="item col-lg-4 col-md-4 col-sm-6 col-xs-12">
								<div class="product">
									<div class="pro-info">
										<div class="ptitle">
											<t t-if="establecimiento">
												<a itemprop="name" t-att-href="keep('/directorio/establecimientos/%s' % slug(establecimiento), category=0)" t-field="establecimiento.name"/>
											</t>
											<t t-if="producto_contratado">
												<t t-if="producto_contratado.product_tur_id">
													<t t-set="product_type" t-value='producto_contratado.product_tur_id.tipo_producto' />
													<a itemprop="name" t-attf-href="/shop/product/#{ slug(producto_contratado.product_tur_id) }" t-field="producto_contratado.product_tur_id.name"/>												
												</t>
											</t>
											<t t-if="evento">
												<a itemprop="name" t-att-href="keep('/directorio/eventos/%s' % slug(evento), category=0)" t-field="evento.name"/>
											</t>
										</div>
									</div>
									
									<div t-attf-class="product-img {{establecimiento and 'establecimiento-img' or ''}} {{producto_contratado and 'producto-img' or ''}}">
										<t t-if="establecimiento">
											<a class="product-image" title="" t-attf-href="/directorio/establecimientos/#{ slug(establecimiento) }">
												<span t-field="establecimiento.image_thumb" t-field-options='{"widget": "image", "class": "img img-responsive"}' />
											</a>
										</t>
										<t t-if="producto_contratado">
											<t t-if="producto_contratado.product_tur_id">
												<t t-set="product_type" t-value='producto_contratado.product_tur_id.tipo_producto' />
												
												<a class="product-image" title="" t-attf-href="/shop/product/#{ slug(producto_contratado.product_tur_id) }">
													<span t-field="producto_contratado.image_thumb" t-field-options='{"widget": "image", "class": "img img-responsive"}' />
												</a>
											</t>
											<t t-if="not producto_contratado.product_tur_id">
												<a itemprop="url" t-att-href="website.sanitize_url(producto_contratado.url)">
													<div t-attf-class="oe_product_image">
														<span t-field="producto_contratado.image_thumb" t-field-options='{"widget": "image", "class": "img img-responsive"}' />
													</div>
												</a>
											</t>
										</t>
										<t t-if="evento">
											<a class="product-image" title="" t-attf-href="/directorio/eventos/#{ slug(evento) }">
												<span t-field="evento.organizer_id.image" t-field-options='{"widget": "image", "class": "img img-responsive"}' />
											</a>
										</t>        
									</div>
									
									<div class="pro-info" t-if="establecimiento">
										<div style="float:right;">
											&amp;nbsp;
											<t t-foreach="establecimiento.services" t-as="service">
												<i t-attf-class="fa fa-{{service.icon}} est-icon" t-att-title='service.name'></i>
											</t>
										</div>
									</div>
									
									<t t-if="establecimiento">
										<t t-if="establecimiento.tripadvisor_url">
											<div t-attf-id="TA_socialButtonBubbles#{ establecimiento.id }" class="TA_socialButtonBubbles">
												<ul id="f9MmteFc" class="TA_links byvE2a64XA">
													<li id="cJ6ruVZoB" class="6jmBS9V">
														<a target="_blank" t-attf-href="#{ establecimiento.tripadvisor_url }"><img src="http://www.tripadvisor.es/img/cdsi/img2/branding/socialWidget/20x28_green-21693-2.png"/></a>
													</li>
												</ul>
											</div>

											<script t-attf-src="http://www.jscache.com/wejs?wtype=socialButtonBubbles&amp;uniq=#{ establecimiento.id }&amp;locationId=#{ establecimiento.get_tripadvisor_id() }&amp;color=green&amp;size=rect&amp;lang=es&amp;display_version=2"></script>
										</t>
									</t>
								</div>
							</div>
						</t>
					</t>
				</t>
			</t>
			<t t-if="not bins">
				<div class="text-center text-muted">
					<div class="expanded-message well col-md-6 col-md-offset-3">
						<h3>No se han encontrado resultados.</h3>            
					</div>
				</div>
			</t>
		</template>
		
	</data>
</openerp>
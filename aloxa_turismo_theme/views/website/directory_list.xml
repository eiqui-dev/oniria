<?xml version="1.0" encoding="utf-8"?>
<openerp>
    <data>
    
		<template id="directory_list">						
			<!-- VISTA LISTA -->
			<div class="modal fade" tabindex="-1" role="dialog" id="map-viewer">
				<div class="modal-dialog">
			    	<div class="modal-content">
			      		<div class="modal-header">
			        		<button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true"><i class="fa fa-close"></i></span></button>
			        		<h4 class="modal-title">Mapa</h4>
			      		</div>
			      		<div class="modal-body">
			        		<img id="map-img" />
			      		</div>
			      		<div class="modal-footer">
			        		<button type="button" class="btn btn-default" data-dismiss="modal">Cerrar</button>
			      		</div>
			    	</div><!-- /.modal-content -->
			  	</div><!-- /.modal-dialog -->
			</div><!-- /.modal -->
			<t t-foreach="bins" t-as="tr_product">
				<t t-foreach="tr_product" t-as="td_product">
					<t t-if="td_product">
						<t t-set="establecimiento" t-value="td_product['establecimiento']"/>
                      	<t t-set="producto_contratado" t-value="td_product['producto_contratado']"/>
						<t t-set="evento" t-value="td_product['events'] if 'events' in td_product and td_product['events'] and len(td_product['events'])==1 else False"/>

						<!-- LISTA -->
						<t t-if="request.session['directory_view'] == 'list'">													
							<div class="col-md-12 product-list-item">
								<div class="col-md-4 product-img">
									<t t-if="establecimiento">
										<a class="product-image" title="" t-attf-href="/directorio/establecimientos/#{ slug(establecimiento) }">
											<span t-field="establecimiento.image_thumb" t-field-options='{"widget": "image", "class": ""}' />
										</a>
									</t>
									<t t-if="producto_contratado">
										<t t-if="producto_contratado.product_tur_id">
											<t t-set="product_type" t-value='producto_contratado.product_tur_id.tipo_producto' />
											
											<a class="product-image" title="" t-attf-href="/shop/product/#{ slug(producto_contratado.product_tur_id) }">
												<span t-field="producto_contratado.image_thumb" t-field-options='{"widget": "image", "class": ""}' />
											</a>
										</t>
										<t t-if="not producto_contratado.product_tur_id">
											<a itemprop="url" t-att-href="website.sanitize_url(producto_contratado.url)">
												<div t-attf-class="oe_product_image">
													<span t-field="producto_contratado.image_thumb" t-field-options='{"widget": "image", "class": ""}' />
												</div>
											</a>
										</t>
									</t>
									<t t-if="evento">
										<a class="product-image" title="" t-attf-href="/directorio/eventos/#{ slug(evento) }">
											<span t-field="evento.organizer_id.image" t-field-options='{"widget": "image", "class": ""}' />
										</a>
									</t>          
								</div>
								<div class="col-md-8">
									<h3 style="margin:0;font-weight: 700; color:#666;">
										<t t-if="establecimiento">
											<a class="product-list-item-name" itemprop="name" t-att-href="keep('/directorio/establecimientos/%s' % slug(establecimiento), category=0)" t-esc="establecimiento.name.upper()"/>
											<div style="float:right;">
												&amp;nbsp;
												<t t-foreach="establecimiento.services" t-as="service">
													<i t-attf-class="fa fa-{{service.icon}} est-icon" t-att-title='service.name'></i>
												</t>
											</div>
										</t>
										<t t-if="producto_contratado">
											<t t-if="producto_contratado.product_tur_id">
												<t t-set="product_type" t-value='producto_contratado.product_tur_id.tipo_producto' />
												<a class="product-list-item-name" itemprop="name" t-att-href="keep('/shop/product/%s' % slug(producto_contratado.product_tur_id), category=0)" t-esc="producto_contratado.product_tur_id.name.upper()"/>												
											</t>
										</t>
										<t t-if="evento">
											<a class="product-list-item-name" itemprop="name" t-att-href="keep('/directorio/eventos/%s' % slug(evento), category=0)" t-esc="evento.name.upper()"/>
										</t>
									</h3>
									<t t-if="establecimiento">
										<t t-set="address" t-value="establecimiento.partner_id.get_composed_address(',')"/>
										<div class="product-list-item-address">
											<i class="fa fa-map-marker"></i>
											<t t-if="not address == ''">
												<a href="#" data-toggle="modal" data-target="#map-viewer" class="open-map-image" t-att-data-address="address" t-esc="address" />
											</t>
											<t t-if="address == ''">
												<span>Address not defined.</span>
											</t>
										</div>
										<div style="margin-top:0.3em;">
											<span t-if="establecimiento.descripcion and len(establecimiento.descripcion) &gt; 200"> 
				 								<t t-set="description" t-value="establecimiento.descripcion[:200] and establecimiento.descripcion[:200].replace('+', '\n')+'...'"/>
												<p><t t-esc="description"/></p>
											</span>				
											<span t-if="establecimiento.descripcion and len(establecimiento.descripcion) &lt; 200">
												<p t-if="establecimiento.descripcion and len(establecimiento.descripcion)&gt; 0" t-field="establecimiento.descripcion"/>
											</span>
											
											<t t-set="events" t-value="td_product['events']"/>
									  		<table t-if="len(events) > 0" class="table table-condensed table-hover table-events-directory">
												<thead>
													<th style="font-weight: normal;">Evento</th>
													<th> </th>
												</thead>
												<tbody>
													<tr t-foreach="events" t-as="event">
														<td style="text-align:left; vertical-align: middle;"><strong style="margin:0; font-weight: bold;" t-esc="event.name" /></td>
														<td><a t-att-href="keep('/establecimiento/%s#events' % slug(establecimiento), category=0)" class="pull-right btn btn-primary" t-field="event.date_begin" /></td>
													</tr>
												</tbody>
											</table>
										</div>
									</t>
									<t t-if="producto_contratado">
										<div style="margin-top:0.3em;">
											<span t-if="producto_contratado.product_tur_id.description and len(producto_contratado.product_tur_id.description) &gt; 200"> 
				 								<t t-set="description" t-value="producto_contratado.product_tur_id.description[:200] and producto_contratado.product_tur_id.description[:200].replace('+', '\n')+'...'"/>
												<p><t t-esc="description"/></p>
											</span>				
											<span t-if="producto_contratado.product_tur_id.description and len(producto_contratado.product_tur_id.description) &lt; 200">
												<p t-if="producto_contratado.product_tur_id.description and len(producto_contratado.product_tur_id.description)&gt; 0" t-field="producto_contratado.product_tur_id.description" />
											</span>
										</div>
									</t>
									<t t-if="evento">
										<t t-set="address" t-value="evento.organizer_id.get_composed_address(',')"/>
										<div class="product-list-item-address">
											<i class="fa fa-map-marker"></i>
											<t t-if="not address == ''">
												<a href="#" data-toggle="modal" data-target="#map-viewer" class="open-map-image" t-att-data-address="address" t-esc="address" />
											</t>
											<t t-if="address == ''">
												<span>Address not defined.</span>
											</t>
											<span t-esc="' (%s)' %evento.organizer_id.name"/>
										</div>
										<div>
											<i class="fa fa-clock-o"></i>
											<span t-field="evento.date_begin" t-widget="datetime"/>
											<i>to</i>
											<span t-field="evento.date_end" t-widget="datetime"/>
										</div>
										<div style="margin-top:0.3em;">
											<span t-if="evento.description and len(evento.description) &gt; 200"> 
				 								<t t-set="description" t-value="evento.description[:200] and evento.description[:200].replace('+', '\n')+'...'"/>
												<p><t t-esc="description"/></p>
											</span>				
											<span t-if="evento.description and len(evento.description) &lt; 200">
												<p t-if="evento.description and len(evento.description)&gt; 0" t-field="evento.description" />
											</span>
										</div>
									</t>
								</div>
							</div>
						</t>
					</t>
				</t>
			</t>
			<t t-if="not bins">
				<div class="text-center text-muted">
					<div class="expanded-message well col-md-6 col-md-offset-3">
						<h3>No se han encontrado resultados.</h3>            
					</div>
				</div>
			</t>
		</template>
		
	</data>
</openerp>
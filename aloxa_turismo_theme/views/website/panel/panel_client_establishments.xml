<?xml version="1.0" encoding="utf-8"?>
<openerp>
    <data>    
    
		<template id="panel_client_establishments">
			<h3 t-if="not establecimientos" class="text-muted text-center">No se han encontrado productos</h3>
			<a t-if="establecimientos" style="margin-bottom:20px;" class="btn btn-primary" href="/crear_establecimiento">Crear Establecimiento</a>
			<t t-foreach="establecimientos or []" t-as="est">
				<a t-attf-name="#{slug(est)}"></a>
				<div t-att-class="'panel panel-%s' % ('primary' if est.website_published else 'default')">
					<div class="panel-heading">
						<strong t-esc="est.name.upper()" />
						<span class="pull-right">
							<a t-att-href="'/editar_establecimiento/%s' % slug(est)" class="btn btn-default btn-xs" style="margin-left:0.5em;"><i class="fa fa-pencil"></i> Editar</a>
							<a t-if="not est.website_published" t-att-href="'/preview/establecimiento/%s' % slug(est)" style="margin-left:0.5em;" class="btn btn-default btn-xs"><i class="fa fa-eye"></i> Vista Preliminar</a>
							<a t-if="est.website_published" t-att-href="'/establecimiento/%s' % slug(est)" style="margin-left:0.5em;" class="btn btn-default btn-xs"><i class="fa fa-eye"></i> Ver</a>
						</span>
					</div>
					<div class="panel-body">
						<div class="well" style="margin-bottom:1.5em;">
							<div class="row">
								<div class="col-sm-8 col-md-8">
									<strong>Tipo:</strong> <i t-esc="est.tipo" /><br/>
									<strong>Teléfono:</strong> <i t-esc="est.phone" /><br/>
									<strong>Ubicación:</strong> <i t-esc="est.partner_id.get_composed_address(', ')" /><br/>
									<strong>TripAdvisor URL:</strong> <i t-esc="est.tripadvisor_url" /><br/>
									<strong>Descripción:</strong>
									<span t-if="est.descripcion and len(est.descripcion) &gt; 200"> 
		 								<t t-set="description" t-value="est.descripcion[:200] and est.descripcion[:200].replace('+', '\n')+'...'"/>
										<i><t t-esc="description"/></i>
									</span>				
									<span t-if="est.descripcion and len(est.descripcion) &lt; 200">
										<i t-if="est.descripcion and len(est.descripcion)&gt; 0" t-field="est.descripcion"/>
									</span>
								</div>
								<div class="col-sm-4 col-md-4 text-right">
									<span t-field="est.image_thumb" t-field-options='{"widget": "image", "class": "img img-responsive img-thumbnail"}' />
								</div>
							</div>
						</div>
					
						<h4>Links</h4>
						<t t-set="links" t-value="website.get_contrated_stablisment_links(request.uid,est.id)" />
						<h3 t-if="not links" class="text-muted text-center">No tiene enlaces contratados</h3>
						<table t-if="links" class="table">
							<thead>
								<th>Tipo</th>
								<th>Caduca</th>
								<th class="text-right">Clicks Unicos</th>
								<th class="text-right">Clicks Totales</th>
							</thead>
							<tbody>
								<tr t-foreach="links" t-as="link">
									<td style="vertical-align:middle;" t-esc="link.product_id.name" />
									<td style="vertical-align:middle;" class="text-right"><span t-field="link.fecha_fin"/></td>
									<td style="vertical-align:middle;" class="text-right">0</td>
									<td style="vertical-align:middle;" class="text-right">0</td>
								</tr>
							</tbody>
						</table>
						<div class="text-right">
							<a href="#" t-attf-data-id="#{est.id}" class="btn btn-default btn-xs crear-link-est"><i class="fa fa-plus"></i> Crear Link</a>
						</div>
						<h4>Eventos</h4>
						<t t-set="events" t-value="website.get_stablisment_events(est.partner_id.id)" />
						<h3 t-if="not events" class="text-muted text-center">No existen eventos definidos</h3>
						<table t-if="events" class="table">
							<thead>
								<th>Evento</th>
								<th>Lugar</th>
								<th>Fecha Inicio</th>
								<th>Fecha Fin</th>
							</thead>
							<tbody>
								<t t-foreach="events" t-as="event">
									<tr t-att-class="(event.date_end >= str(datetime.datetime.now())) and 'success' or 'danger'">
										<td style="vertical-align:middle;" t-esc="event.name" />
										<td style="vertical-align:middle;" t-esc="event.address_id.get_composed_address(', ')" />
										<td style="vertical-align:middle;" t-esc="event.date_begin" />
										<td style="vertical-align:middle;" t-esc="event.date_end" />
									</tr>
									<tr class="tr-event-tickets-panel">
										<td colspan="4">
											<strong>Tickets:</strong><br/>
											<h3 t-if="not event.event_ticket_ids" class="text-muted text-center">No existen tickets definidos</h3>
											<table t-if="event.event_ticket_ids" class="table">
												<thead>
													<th>Fin de las ventas</th>
													<th class="text-right">Precio</th>
													<th class="text-right">Plazas máximas disponibles</th>
													<th class="text-right">Plazas reservadas</th>
													<th class="text-right">Reservas de plaza no confirmadas</th>
												</thead>
												<tbody>
													<tr t-foreach="event.event_ticket_ids" t-as="ticket">
														<td style="vertical-align:middle;" t-esc="ticket.deadline">
															<t t-if="ticket.deadline" t-esc="ticket.deadline" />
															<t t-if="not ticket.deadline" t-esc="'Nunca'" />
														</td>
														<td style="vertical-align:middle;" class="text-right" t-esc="'%.2f€' % ticket.price" />
														<td style="vertical-align:middle;" class="text-right" t-esc="ticket.seats_max" />
														<td style="vertical-align:middle;" class="text-right" t-esc="ticket.seats_reserved" />
														<td style="vertical-align:middle;" class="text-right" t-esc="ticket.seats_unconfirmed" />
													</tr>
												</tbody>
											</table>
											<a href="#" t-attf-data-id="#{event.id}" class="btn btn-xs btn-default create-ticket"><i class="fa fa-plus"></i> Crear Ticket</a>
										</td>
									</tr>
								</t>
							</tbody>
						</table>
						<div class="text-right">
							<a t-attf-href="/crear_evento/#{slug(est)}" class="btn btn-default btn-xs"><i class="fa fa-plus"></i> Crear Evento</a>
						</div>
						<h4>Productos</h4>
						<t t-set="products" t-value="website.get_stablisment_products(est.partner_id.id)" />
						<h3 t-if="not products" class="text-muted text-center">Sin productos</h3>
						<table t-if="products" class="table">
							<thead>
								<th>Nombre</th>
								<th class="text-right col-md-2 col-xs-2">Precio</th>
							</thead>
							<tbody>
								<tr t-foreach="products" t-as="product">
									<td style="vertical-align:middle;" t-esc="product.name" />
									<td style="vertical-align:middle;" class="text-right" t-esc="'%.2f€' % product.list_price"/>
								</tr>
							</tbody>
						</table>
						<div class="text-right" style="clear:both;">
							<a href="#" t-attf-data-id="#{est.id}" class="btn btn-default btn-xs anhadir-producto"><i class="fa fa-plus"></i> Añadir Producto</a>
						</div>
						<h4>Imágenes</h4>
				  		<h3 t-if="len(est.images) == 0" class="text-muted text-center">No se han encontrado imágenes</h3>
				  		<t t-foreach="est.images" t-as="image">
				  			<div class="col-sm-4 col-md-4">
					  			<div class="thumbnail">
					  				<img t-attf-src="/web/binary/image?model=establecimiento.images&amp;id=#{image.id}&amp;field=image"/>
							   		<div class="caption">
							        	<strong t-esc="image.name"/>
							      </div>
							    </div>
						    </div>
				  		</t>
						<div class="text-right" style="clear:both;">
							<a href="#" t-attf-data-id="#{est.id}" class="btn btn-default btn-xs anhadir-imagen"><i class="fa fa-plus"></i> Añadir Imágen</a>
						</div>
					</div>
				</div>
			</t>
			<a class="btn btn-primary" href="/crear_establecimiento">Crear Establecimiento</a>
		</template>
		
    </data>
</openerp>
